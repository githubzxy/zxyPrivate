<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yz.center.dao.log.LogDao">
	    
    <!--查询系统日志总数  -->
    <select id="listSysLogCount" parameterType="pageBean" resultType="int">
    	SELECT
			COUNT(1)
		FROM
			visit_record a
		LEFT JOIN user_info b ON a.user_id = b.user_id
		WHERE b.school_id = #{schoolId}
    </select>
    <select id="listSysLog" parameterType="pageBean" resultType="com.yz.center.model.vo.log.SysLogVo">
    	SELECT
			a.log_id logId,
			a.createDate createDate,
			a.type_id typeId,
			c.visit_type_name type,
			a.user_id userId,
			b.`name` userName,
			d.role_name role,
			e.loginName loginName
		FROM
			visit_record a
		LEFT JOIN user_info b ON a.user_id = b.user_id
		LEFT JOIN visit_type c ON a.type_id = c.visit_type_id
		LEFT JOIN role_info d ON b.roleCode = d.roleCode
		LEFT JOIN login_info e ON e.login_id = b.loginId
		WHERE b.school_id = #{schoolId}
		LIMIT #{startIndex},#{pageSize}
    </select>
</mapper>